<!DOCTYPE html>
<html lang="en">
<head>
  <title>Login - Botify</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='image/favicon.ico') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Google Sign-In API -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body class="bg-light">

<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <div class="card p-4 shadow rounded w-100" style="max-width: 500px;">
    
    <!-- Logo -->
    <div class="text-center mb-3">
      <img src="{{ url_for('static', filename='image/botify.png') }}" alt="Botify Logo" class="img-fluid" style="max-width: 160px;">
    </div>
    
    <h2 class="mb-4 text-center">Login</h2>
    
    {% if error %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong>Oops!</strong> {{ error }}
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    {% endif %}
    
    <form action="/login" method="POST">
      {{ form.hidden_tag() }}
      
      <!-- Username -->
      <div class="form-group">
        {{ form.username.label(class="form-label") }}
        {{ form.username(class="form-control", id="username", placeholder="Enter your username") }}
        {% if form.username.errors %}
          <ul class="text-danger">
            {% for error in form.username.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      
      <!-- Password -->
      <div class="form-group">
        {{ form.password.label(class="form-label") }}
        <div class="input-group">
          {{ form.password(class="form-control", id="password", placeholder="Enter your password") }}
          <div class="input-group-append">
            <button type="button" class="btn btn-outline-secondary" id="togglePassword">
              <i class="fas fa-eye" id="toggleIcon"></i>
            </button>
          </div>
        </div>
        {% if form.password.errors %}
          <ul class="text-danger">
            {% for error in form.password.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      
      <!-- Submit & Link -->
      <div class="text-center">
        {{ form.submit(class="btn btn-success btn-block mt-3") }}
      </div>
    </form>
    
    <!-- Social Login Divider -->
    <div class="d-flex align-items-center my-3">
      <div class="flex-grow-1 border-bottom"></div>
      <div class="mx-3 text-muted">OR</div>
      <div class="flex-grow-1 border-bottom"></div>
    </div>
    
    <!-- Google Sign-In Button -->
    <div id="g_id_onload"
         data-client_id="YOUR_GOOGLE_CLIENT_ID"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleGoogleSignIn"
         data-auto_prompt="false">
    </div>
    
    <div class="d-flex justify-content-center mb-3">
      <div class="g_id_signin" 
           data-type="standard"
           data-shape="rectangular"
           data-theme="outline"
           data-text="signin_with"
           data-size="large"
           data-logo_alignment="left">
      </div>
    </div>
    
    <!-- Registration Link -->
    <div class="text-center">
      <a href="{{ url_for('register') }}" class="d-inline-flex align-items-center mt-2">
        <img src="{{ url_for('static', filename='image/register.png') }}" alt="Register Icon" class="img-fluid mr-2" width="20" height="20">
        <span>You don't have an account?</span>
      </a>
    </div>
  </div>
</div>

<!-- External JavaScript -->
<script src="{{ url_for('static', filename='js/form.js') }}"></script>

<!-- Google Sign-In JavaScript -->
<script>
  function handleGoogleSignIn(response) {
    // Get the ID token from the response
    const idToken = response.credential;
    
    // Send the token to your server
    fetch('/login/google', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ token: idToken })
    })
    .then(response => {
      if (response.redirected) {
        window.location.href = response.url;
      } else {
        return response.json();
      }
    })
    .then(data => {
      if (data && data.error) {
        console.error('Google sign-in error:', data.error);
        // Display error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'alert alert-danger alert-dismissible fade show';
        errorDiv.innerHTML = `
          <strong>Oops!</strong> ${data.error}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        `;
        document.querySelector('.card').insertBefore(errorDiv, document.querySelector('h2').nextSibling);
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  }
</script>

</body>
</html>