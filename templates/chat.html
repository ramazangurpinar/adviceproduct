{% extends "master.html" %}

{% block title %}Chat - Botify{% endblock %}

{% block content %}
<div class="container-fluid py-3">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10 col-sm-12">
      <div class="card shadow border-0 rounded-3">
        <div class="card-header bg-primary text-white text-center">
          <h4 class="mb-0">ðŸ’¬ Botify AI Chatbot</h4>
        </div>
        <div class="card-body" style="height: 75vh; overflow-y: auto;" id="chatBox">
        </div>
        <div class="card-footer">
          <div class="input-group">
            <input type="text" id="messageInput" class="form-control" placeholder="Enter your message..." onkeydown="if(event.key==='Enter') sendMessage()">
            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SocketIO & Chat Logic -->
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
  .message-wrapper {
    display: flex;
    flex-direction: column;
    margin-bottom: 12px;
  }
  .message-bubble {
    padding: 10px 15px;
    border-radius: 18px;
    max-width: 60%;
    word-wrap: break-word;
  }
  .user-message {
    align-self: flex-end;
    background-color: #0d6efd;
    color: white;
  }
  .bot-message {
    align-self: flex-start;
    background-color: #198754;
    color: white;
  }
</style>

<script>
  const socket = io();
  const chatBox = document.getElementById("chatBox");
  const input = document.getElementById("messageInput");

  function appendMessage(text, sender) {
    const wrapper = document.createElement("div");
    wrapper.classList.add("message-wrapper");
    const bubble = document.createElement("div");
    bubble.classList.add("message-bubble");
    bubble.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
    bubble.textContent = text;
    wrapper.appendChild(bubble);
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function sendMessage() {
    const message = input.value.trim();
    if (!message) return;
    appendMessage(message, "user");
    socket.emit("user_message", { message });
    input.value = "";
  }

  socket.on("bot_response", function(data) {
    appendMessage(data.message, "bot");
  });
</script>
{% endblock %}